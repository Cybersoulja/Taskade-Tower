name: Taskade AI â†’ Build Site Files

on:
  issues:
    types: [opened]

permissions:
  contents: write
  issues: read

jobs:
  build-from-issue:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Extract issue content
        run: |
          # Write the full issue body safely to a file
          echo "${{ github.event.issue.body }}" > issue.txt

          # Extract sections based on headers
          awk '/## HTML/{flag=1;next}/## CSS/{flag=0}flag' issue.txt > index.html
          awk '/## CSS/{flag=1;next}/## JavaScript/{flag=0}flag' issue.txt > style.css
          awk '/## JavaScript/{flag=1;next}/##/{flag=0}flag' issue.txt > script.js

          # Create assets directory
          mkdir -p assets
          mv style.css assets/style.css
          mv script.js assets/script.js

      - name: Commit generated files
        run: |
          git config user.name "taskade-ai-bot"
          git config user.email "ai@taskade.dev"

          git add index.html assets/style.css assets/script.js

          git commit -m "AI build from issue #${{ github.event.issue.number }}" || echo "Nothing to commit"

          git push
